(window["webpackJsonpapp"] = window["webpackJsonpapp"] || []).push([[1],{

/***/ "./src/fps.js":
/*!********************!*\
  !*** ./src/fps.js ***!
  \********************/
/*! exports provided: FpsState, FpsDomElement, FpsSystem */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FpsState\", function() { return FpsState; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FpsDomElement\", function() { return FpsDomElement; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FpsSystem\", function() { return FpsSystem; });\n/* harmony import */ var ecsy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ecsy */ \"./node_modules/ecsy/build/ecsy.module.js\");\n\r\n\r\nclass FpsState {\r\n  constructor() {\r\n    this.frameCount = 0;\r\n    this.totalElapsedTime = 0.0;\r\n  }\r\n\r\n  reset() {\r\n    this.frameCount = 0;\r\n    this.totalElapsedTime = 0.0;\r\n  }\r\n}\r\n\r\nclass FpsDomElement {\r\n  constructor() {\r\n    this.element = null;\r\n  }\r\n\r\n  reset() {\r\n    this.element = null;\r\n  }\r\n}\r\n\r\nclass FpsSystem extends ecsy__WEBPACK_IMPORTED_MODULE_0__[\"System\"] {\r\n  execute(delta) {\r\n    this.queries.entities.results.forEach(entity => {\r\n      const state = entity.getMutableComponent(FpsState);\r\n      state.frameCount += 1;\r\n      state.totalElapsedTime += delta;\r\n      if ((state.frameCount % 60) === 0) {\r\n        const element = entity.getMutableComponent(FpsDomElement).element;\r\n        element.textContent = (1000.0 / (state.totalElapsedTime / 60)).toFixed(2);\r\n        state.totalElapsedTime = 0.0;\r\n        state.frameCount = 0;\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nFpsSystem.queries = {\r\n  entities: {components: [FpsState, FpsDomElement]}\r\n};\r\n\r\n\r\n\n\n//# sourceURL=webpack://app/./src/fps.js?");

/***/ }),

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/*! exports provided: run */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"run\", function() { return run; });\n/* harmony import */ var ecsy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ecsy */ \"./node_modules/ecsy/build/ecsy.module.js\");\n/* harmony import */ var _fps__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./fps */ \"./src/fps.js\");\n/* harmony import */ var _key_input__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./key_input */ \"./src/key_input.js\");\n/* harmony import */ var _nes__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./nes */ \"./src/nes.js\");\n/* harmony import */ var _renderer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./renderer */ \"./src/renderer.js\");\n\r\n\r\n\r\n\r\n\r\n\r\nconst run = (romContentArray, nesCanvas, fpsSpan) => {\r\n  const world = new ecsy__WEBPACK_IMPORTED_MODULE_0__[\"World\"]()\r\n    .registerSystem(_key_input__WEBPACK_IMPORTED_MODULE_2__[\"KeyInputSystem\"])\r\n    .registerSystem(_nes__WEBPACK_IMPORTED_MODULE_3__[\"NesSystem\"])\r\n    .registerSystem(_renderer__WEBPACK_IMPORTED_MODULE_4__[\"RendererSystem\"]);\r\n\r\n  if (fpsSpan) {\r\n    world.createEntity()\r\n      .addComponent(_fps__WEBPACK_IMPORTED_MODULE_1__[\"FpsState\"])\r\n      .addComponent(_fps__WEBPACK_IMPORTED_MODULE_1__[\"FpsDomElement\"], {element: fpsSpan});\r\n    world\r\n      .registerSystem(_fps__WEBPACK_IMPORTED_MODULE_1__[\"FpsSystem\"]);\r\n  }\r\n\r\n  world.createEntity()\r\n    .addComponent(_key_input__WEBPACK_IMPORTED_MODULE_2__[\"KeyInputState\"])\r\n    .addComponent(_nes__WEBPACK_IMPORTED_MODULE_3__[\"NesComponent\"])\r\n    .addComponent(_nes__WEBPACK_IMPORTED_MODULE_3__[\"NesRom\"], {content: romContentArray})\r\n    .addComponent(_renderer__WEBPACK_IMPORTED_MODULE_4__[\"OutputBuffer\"])\r\n    .addComponent(_renderer__WEBPACK_IMPORTED_MODULE_4__[\"OutputContext\"], {canvas: nesCanvas});\r\n\r\n  // animation frame loop\r\n  const stepFrame = () => {\r\n    requestAnimationFrame(stepFrame);\r\n\r\n    // Run all the systems\r\n    world.execute();\r\n  };\r\n\r\n  stepFrame();\r\n};\r\n\r\n\r\n\n\n//# sourceURL=webpack://app/./src/index.js?");

/***/ }),

/***/ "./src/key_input.js":
/*!**************************!*\
  !*** ./src/key_input.js ***!
  \**************************/
/*! exports provided: KeyInputState, KeyInputSystem */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"KeyInputState\", function() { return KeyInputState; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"KeyInputSystem\", function() { return KeyInputSystem; });\n/* harmony import */ var ecsy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ecsy */ \"./node_modules/ecsy/build/ecsy.module.js\");\n/* harmony import */ var nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! nes_rust_wasm */ \"./node_modules/nes_rust_wasm/pkg/nes_rust_wasm.js\");\n\r\n\r\n\r\nclass KeyInputState {\r\n  constructor() {\r\n    this.keydowns = [];\r\n    this.keyups = [];\r\n  }\r\n\r\n  reset() {\r\n    this.keydowns.length = 0;\r\n    this.keyups.length = 0;\r\n  }\r\n}\r\n\r\nclass KeyInputSystem extends ecsy__WEBPACK_IMPORTED_MODULE_0__[\"System\"] {\r\n  execute() {\r\n    this.queries.entities.added.forEach(entity => {\r\n      const state = entity.getMutableComponent(KeyInputState);\r\n\r\n      // @TODO: Mapping should be configurable\r\n      const getButton = keyCode => {\r\n        switch (keyCode) {\r\n          case 32: // space\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Start;\r\n          case 37: // Left\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Joypad1Left;\r\n          case 38: // Up\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Joypad1Up;\r\n          case 39: // Right\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Joypad1Right;\r\n          case 40: // Down\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Joypad1Down;\r\n          case 50: // 2\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Joypad2Down;\r\n          case 52: // 4\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Joypad2Left;\r\n          case 54: // 6\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Joypad2Right;\r\n          case 56: // 8\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Joypad2Up;\r\n          case 65: // A\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Joypad1A;\r\n          case 66: // B\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Joypad1B;\r\n          case 82: // R\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Reset;\r\n          case 83: // S\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Select;\r\n          case 88: // X\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Joypad2A;\r\n          case 90: // Z\r\n            return nes_rust_wasm__WEBPACK_IMPORTED_MODULE_1__[\"Button\"].Joypad2B;\r\n          default:\r\n            return null; \r\n        }\r\n      };\r\n\r\n      window.addEventListener('keydown', event => {\r\n        const button = getButton(event.keyCode);\r\n        if (button === null) {\r\n          return;\r\n        }\r\n        if (!state.keydowns.includes(button)) {\r\n          state.keydowns.push(button);\r\n        }\r\n        event.preventDefault();\r\n      }, false);\r\n\r\n      window.addEventListener('keyup', event => {\r\n        const button = getButton(event.keyCode);\r\n        if (button === null) {\r\n          return;\r\n        }\r\n        if (!state.keyups.includes(button)) {\r\n          state.keyups.push(button);\r\n        }\r\n        event.preventDefault();\r\n      }, false);\r\n    });\r\n  }\r\n}\r\n\r\nKeyInputSystem.queries = {\r\n  entities: {\r\n    components: [KeyInputState],\r\n    listen: {added: true}\r\n  }\r\n};\r\n\r\n\r\n\n\n//# sourceURL=webpack://app/./src/key_input.js?");

/***/ }),

/***/ "./src/nes.js":
/*!********************!*\
  !*** ./src/nes.js ***!
  \********************/
/*! exports provided: NesComponent, NesRom, NesSystem */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"NesComponent\", function() { return NesComponent; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"NesRom\", function() { return NesRom; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"NesSystem\", function() { return NesSystem; });\n/* harmony import */ var ecsy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ecsy */ \"./node_modules/ecsy/build/ecsy.module.js\");\n/* harmony import */ var _key_input__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./key_input */ \"./src/key_input.js\");\n/* harmony import */ var _renderer__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./renderer */ \"./src/renderer.js\");\n/* harmony import */ var nes_rust_wasm__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! nes_rust_wasm */ \"./node_modules/nes_rust_wasm/pkg/nes_rust_wasm.js\");\n\r\n\r\n\r\n\r\n\r\nclass NesComponent {\r\n  constructor() {\r\n    this.nes = null;\r\n  }\r\n\r\n  reset() {\r\n    this.nes = null;\r\n  }\r\n}\r\n\r\nclass NesRom {\r\n  constructor() {\r\n    this.content = null;\r\n  }\r\n\r\n  reset() {\r\n    this.content = null;\r\n  }\r\n}\r\n\r\nclass NesSystem extends ecsy__WEBPACK_IMPORTED_MODULE_0__[\"System\"] {\r\n  execute() {\r\n    this.queries.entities.added.forEach(entity => {\r\n      const nesComponent = entity.getMutableComponent(NesComponent);\r\n      const rom = entity.getMutableComponent(NesRom).content;\r\n      const outputBuffer = entity.getMutableComponent(_renderer__WEBPACK_IMPORTED_MODULE_2__[\"OutputBuffer\"]);\r\n      const outputContext = entity.getMutableComponent(_renderer__WEBPACK_IMPORTED_MODULE_2__[\"OutputContext\"]);\r\n\r\n      const nes = nes_rust_wasm__WEBPACK_IMPORTED_MODULE_3__[\"WasmNes\"].new();\r\n\r\n      const width = 256;\r\n      const height = 240;\r\n      const canvas = outputContext.canvas;\r\n      const ctx = canvas.getContext('2d');\r\n      const imageData = ctx.createImageData(width, height);\r\n      const pixels = new Uint8Array(imageData.data.buffer);\r\n\r\n      // Set up Audio\r\n      const setupAudio = () => {\r\n        const audioContext = AudioContext || webkitAudioContext;\r\n\r\n        if (audioContext === undefined) {\r\n          throw new Error('This browser seems not to support AudioContext.');\r\n        }\r\n\r\n        const bufferLength = 4096;\r\n        const context = new audioContext({sampleRate: 44100});\r\n        const scriptProcessor = context.createScriptProcessor(bufferLength, 0, 1);\r\n\r\n        scriptProcessor.onaudioprocess = e => {\r\n          const data = e.outputBuffer.getChannelData(0);\r\n          nes.update_sample_buffer(data);\r\n        };\r\n\r\n        scriptProcessor.connect(context.destination);\r\n      };\r\n\r\n      setupAudio();\r\n\r\n      // Boot up\r\n\r\n      nes.set_rom(rom);\r\n      nes.bootup();\r\n\r\n      // Update component\r\n\r\n      nesComponent.nes = nes;\r\n      outputBuffer.pixels = pixels;\r\n      outputBuffer.imageData = imageData;\r\n      outputContext.context = ctx;\r\n    });\r\n\r\n    this.queries.entities.results.forEach(entity => {\r\n      const nesComponent = entity.getMutableComponent(NesComponent);\r\n      const nes = nesComponent.nes;\r\n      const pixels = entity.getMutableComponent(_renderer__WEBPACK_IMPORTED_MODULE_2__[\"OutputBuffer\"]).pixels;\r\n\r\n      const inputState = entity.getMutableComponent(_key_input__WEBPACK_IMPORTED_MODULE_1__[\"KeyInputState\"]);\r\n      inputState.keydowns.forEach(button => {\r\n        nes.press_button(button);\r\n      });\r\n      inputState.keyups.forEach(button => {\r\n        nes.release_button(button);\r\n      });\r\n      inputState.keydowns.length = 0;\r\n      inputState.keyups.length = 0;\r\n\r\n      nes.step_frame();\r\n      nes.update_pixels(pixels);\r\n    });\r\n  }\r\n}\r\n\r\nNesSystem.queries = {\r\n  entities: {\r\n    components: [NesComponent, NesRom, _renderer__WEBPACK_IMPORTED_MODULE_2__[\"OutputBuffer\"], _key_input__WEBPACK_IMPORTED_MODULE_1__[\"KeyInputState\"]],\r\n    listen: {added: true}\r\n  }\r\n};\r\n\r\n\r\n\n\n//# sourceURL=webpack://app/./src/nes.js?");

/***/ }),

/***/ "./src/renderer.js":
/*!*************************!*\
  !*** ./src/renderer.js ***!
  \*************************/
/*! exports provided: OutputBuffer, OutputContext, RendererSystem */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"OutputBuffer\", function() { return OutputBuffer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"OutputContext\", function() { return OutputContext; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"RendererSystem\", function() { return RendererSystem; });\n/* harmony import */ var ecsy__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ecsy */ \"./node_modules/ecsy/build/ecsy.module.js\");\n\r\n\r\nclass OutputBuffer {\r\n  constructor() {\r\n    this.pixels = null;\r\n    this.imageData = null;\r\n  }\r\n\r\n  reset() {\r\n    this.pixels = null;\r\n    this.imageData = null;\r\n  }\r\n}\r\n\r\nclass OutputContext {\r\n  constructor() {\r\n    this.canvas = null;\r\n    this.context = null;\r\n  }\r\n\r\n  reset() {\r\n    this.canvas = null;\r\n    this.context = null;\r\n  }\r\n}\r\n\r\nclass RendererSystem extends ecsy__WEBPACK_IMPORTED_MODULE_0__[\"System\"] {\r\n  execute() {\r\n    this.queries.entities.results.forEach(entity => {\r\n      const context = entity.getMutableComponent(OutputContext);\r\n      const buffer = entity.getComponent(OutputBuffer);\r\n      context.context.putImageData(buffer.imageData, 0, 0);\r\n    });\r\n  }\r\n}\r\n\r\nRendererSystem.queries = {\r\n  entities: {components: [OutputBuffer, OutputContext]}\r\n};\r\n\r\n\r\n\n\n//# sourceURL=webpack://app/./src/renderer.js?");

/***/ })

}]);